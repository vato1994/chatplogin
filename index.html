<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Custom Delay Multi-Bot</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; padding: 20px; }
    .container { max-width: 550px; margin: auto; background: #1e1e1e; padding: 25px; border-radius: 15px; border: 1px solid #333; }
    h2 { text-align: center; color: #28a745; margin-bottom: 20px; }
    .field-group { display: flex; gap: 10px; margin-bottom: 10px; }
    input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #252525; color: white; box-sizing: border-box; }
    label { font-size: 12px; color: #aaa; margin-left: 5px; }
    button { width: 100%; padding: 15px; background: #28a745; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 8px; margin-top: 10px; }
    #log { margin-top: 20px; height: 250px; overflow-y: auto; background: #000; padding: 10px; font-family: monospace; font-size: 12px; border: 1px solid #444; border-radius: 5px; }
    .settings-box { background: #252525; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
  </style>
</head>
<body>

<div class="container">
  <h2>ðŸ¤– UNLOYAL Multi bet Bot</h2>
  
  <input type="text" id="username" placeholder="Usernames (user1#user2#user3)">
  <input type="password" id="password" placeholder="Common Password">
  <input type="number" id="roomid" placeholder="Room ID">
  
  <div class="settings-box">
    <p style="margin: 0 0 10px 0; font-size: 14px; color: #28a745;">Message & Delay Settings</p>
    <div class="field-group">
      <div style="flex: 2;"><label>Message 1</label><input type="text" id="msg1" value="NILA FIRST MSG"></div>
      <div style="flex: 2;"><label>Message 2</label><input type="text" id="msg2" value="NILA SECOND MSG"></div>
    </div>
    <div class="field-group">
      <div style="flex: 1;"><label>Msg Delay (sec)</label><input type="number" id="msgDelay" value="2"></div>
      <div style="flex: 1;"><label>Loop Gap (sec)</label><input type="number" id="loopGap" value="5"></div>
    </div>
  </div>

  <button id="startBtn">Launch All Bots</button>
  <div id="log"></div>
</div>

<script>
  const logDiv = document.getElementById('log');
  function addLog(msg) {
    const p = document.createElement('div');
    p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    logDiv.appendChild(p);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  async function login(username, password) {
    try {
      const resp = await fetch("https://api.howdies.app/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      const data = await resp.json();
      return data.token || null;
    } catch (e) { return null; }
  }

  async function startBot() {
    const userStr = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value;
    const room = document.getElementById('roomid').value.trim();
    const m1 = document.getElementById('msg1').value;
    const m2 = document.getElementById('msg2').value;
    const mDelay = parseInt(document.getElementById('msgDelay').value) * 1000;
    const lGap = parseInt(document.getElementById('loopGap').value) * 1000;

    if (!userStr || !pass || !room) return alert("Details fill karein!");

    const users = userStr.split('#');
    addLog(`ðŸš€ Initializing ${users.length} accounts...`);

    for (let user of users) {
      const token = await login(user, pass);
      if (token) {
        addLog(`âœ… Authenticated: ${user}`);
        connectWS(token, user, pass, room, m1, m2, mDelay, lGap);
      } else {
        addLog(`âŒ Auth Failed: ${user}`);
      }
    }
  }

  function connectWS(token, user, pass, room, m1, m2, mDelay, lGap) {
    let socket = new WebSocket(`wss://app.howdies.app/howdies/?token=${token}`);
    let isRunning = true;

    async function startLoop() {
      while (isRunning) {
        if (socket.readyState === 1) {
          // Send Msg 1
          sendMsg(socket, room, m1);
          addLog(`ðŸ“¤ [${user}] Sent: ${m1}`);
          
          // Wait for custom Message Delay
          await new Promise(r => setTimeout(r, mDelay));
          
          if (socket.readyState === 1) {
            // Send Msg 2
            sendMsg(socket, room, m2);
            addLog(`ðŸ“¤ [${user}] Sent: ${m2}`);
          }
          
          // Wait for custom Loop Gap
          await new Promise(r => setTimeout(r, lGap));
        } else {
          // If socket not ready, wait a bit and retry
          await new Promise(r => setTimeout(r, 2000));
        }
      }
    }

    socket.onopen = () => {
      addLog(`ðŸ”Œ [${user}] WebSocket Open`);
      socket.send(JSON.stringify({
        handler: "login", username: user, password: pass, fcmt: "bot", lp: true
      }));

      setTimeout(() => {
        socket.send(JSON.stringify({ handler: "joinchatroom", roomid: parseInt(room) }));
        startLoop(); 
      }, 2000);
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.handler === "chatroommessage") {
        const text = (data.text || "").toLowerCase();
        if ((text.includes("kicked") || text.includes("removed")) && text.includes(user.toLowerCase())) {
          addLog(`ðŸ”„ [${user}] Rejoining...`);
          socket.send(JSON.stringify({ handler: "joinchatroom", roomid: parseInt(room) }));
        }
      }
    };

    socket.onclose = () => {
      isRunning = false;
      addLog(`âš ï¸ [${user}] Connection Lost. Retrying in 5s...`);
      setTimeout(() => connectWS(token, user, pass, room, m1, m2, mDelay, lGap), 5000);
    };
  }

  function sendMsg(ws, roomid, text) {
    if (ws && ws.readyState === 1) {
      ws.send(JSON.stringify({
        handler: "chatroommessage", roomid: parseInt(roomid), text: text, type: "text"
      }));
    }
  }

  document.getElementById('startBtn').onclick = startBot;
</script>

</body>
</html>
